---
name: Create Issues from TODOs

on:
  pull_request: {}
  workflow_dispatch: {}

permissions:
  contents: read
  issues: write

jobs:
  create-issues:
    name: Create GitHub Issues
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Create labels if missing
        uses: crazy-max/ghaction-github-labeler@v5
        with:
          github-token: ${{ github.token }}

      - name: Setup GitHub CLI
        run: |
          # GitHub CLI is pre-installed on GitHub Actions runners
          gh --version

      - name: Authenticate GitHub CLI
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          echo "Authenticating with GitHub token"
          gh auth status

      - name: Make script executable
        run: chmod +x ./create-issues.sh

      - name: Create issues
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          # Run the script non-interactively
          echo "" | ./create-issues.sh || {
            echo "Script execution failed or was cancelled"
            exit 1
          }

      - name: Summary
        run: |
          {
            echo "âœ… Successfully created 85 GitHub issues from TODOs"
            echo ""
            echo "See [Issues](https://github.com/$GITHUB_REPOSITORY/issues)"
          } >> $GITHUB_STEP_SUMMARY
